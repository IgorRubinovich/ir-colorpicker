<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<dom-module id="ir-colorpicker">
  <style>
    :host {
      display: block;
    }

    @media (max-width: 600px) {
      h1.paper-font-display1 {
        font-size: 24px;
      }
    } 
	
	paper-dialog {
		width  : 400px;
	}
	
	paper-dialog-scrollable paper-button, #non-prompt-opener {
		width : 22px;
		min-width : 22px;
		max-width : 22px;
		height : 22px;
		margin : 0;
	}
	
	#non-prompt-opener {
		border : 1px solid #ddd;
	}
	
	paper-dialog-scrollable {
		display : flex;
		flex-wrap : wrap;
	}
	
	
	
  </style>
  <template>
    <paper-button id="non-prompt-opener" hidden$="{{ promptMode }}" on-click="open" style$="{{ bgColor(value) }}"></paper-button>
	<paper-dialog id="dialog">
	  <h2>{{ title }}</h2>
	  <paper-dialog-scrollable>
		<template is="dom-repeat" items="{{ colors }}">
			<paper-button color="{{ item }}" on-click="selectColor" style$="{{ bgColor(item) }}"></paper-button>
		</template>
	  </paper-dialog-scrollable>
	  <div class="buttons">
		<paper-button dialog-dismiss on-tap="cancel">Cancel</paper-button>
		<paper-button dialog-confirm on-tap="promptUpdate">OK</paper-button>
	  </div>
	</paper-dialog>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'ir-colorpicker',

        properties: {
          colors: {
            type: Array,
            notify: true
          },
		  
		  promptMode : {
			type : Boolean,
			value : false,
			notify : true
		  },
		  
		  title : {
			type : String,
			value : "",
			notify : true
		  }
        },
		
		bgColor : function(color) {
			return "background-color : " + color
		},
		
		selectColor : function(ev)
		{
			this.value = ev.currentTarget.color;
		},
		
		open : function(ev)
		{
			this.$.dialog.open();
			this.prevValue = this.value;
		},
				
		prompt : function(callback)
		{
			if(!this.promptMode)
				throw new Error("must be in prompt mode to use .prompt");

			this.promptCallback = callback;
			this.open()
		},
		
		promptClose : function()
		{
			this.$.dialog.close();
		},

		cancel : function(ev)
		{
			this.value = this.prevValue;
		},

		promptUpdate : function()
		{
			if(this.promptMode)
			{
				this.promptCallback(this.value);
				delete this.promptCallback;
				this.inPromptMode = false;
			}
		},
		 
		ready : function() {
			var colors = [], r, g, b, gr, hgr;
			
			for(r = 255; r > 0; r -= 64)
				for(g = 1; g <= 255; g += 64)
					for(b = 1; b <= 255; b += 64)
						colors.push(["#", d2h(r, 2), d2h(g, 2), d2h(b, 2)].join(''));

			for(gr = 1; gr <= 255; gr += 16)
				hgr = d2h(gr,2), colors.push(["#", hgr, hgr, hgr].join(''));
						
			console.log(colors);
			this.set("colors", colors);
		}
      });
	  
	  // convert positive decimal to hex string
	  var hexdigits = "0123456789ABCDEF".split("");
	  function d2h(d, minLen) {
		var unpadded = d ? d2h(Math.floor(d / 16)) + hexdigits[d % 16] : "";
		
		while(minLen && (unpadded.length < minLen))
			unpadded = "0" + unpadded, minLen--;
		
		return unpadded;
	  }
    })();
  </script>

</dom-module>
